<?php	include("globals.php");	include("./classes/class.econt.php");	//error_reporting(E_ALL & ~E_NOTICE);	$id = $params->getInt("id");	$cart_id = $params->getInt("cart_id");    $variant_id = $params->getInt("option_id");    $quantity = $params->getInt("quantity");		if ($id){		addProductToCart($id, $cart_id, $variant_id, $quantity);				$row = $db->getRow("SELECT * FROM ".$carts_table." WHERE id = '".$cart_id."'"); safeCheck($row);		$cartsObj = new Carts();		$cartsObj->cartCalculateTotal($cart_id, $row["user_id"]);				header("Location: carts_ae.php?act=edit&id=".$cart_id);		die();	}		function addProductToCart($product_id, $cart_id, $variant_id, $quantity = 1 ){		global $db;		global $lng;		global $products_table;		global $products_images_table;		global $brands_table;		global $variants_table;		global $carts_products_table;				$product = $db->getRow("SELECT products.*, 									   products.name_{$lng} AS name, 									   (SELECT brands.name_{$lng} FROM ".$brands_table." AS brands WHERE products.brand_id = brands.id) AS brand_name, 									   (SELECT images.id FROM ".$products_images_table." AS images WHERE images.product_id = products.id ORDER BY pos LIMIT 1) AS product_image_id 								FROM ".$products_table." AS products 								WHERE id = '".$product_id."'								"); safeCHeck($product);		$check_product = $db->getRow("SELECT id, quantity, product_weight FROM ".$carts_products_table." WHERE product_id = '".$product_id."' AND cart_id = '".$cart_id."' AND variant_id = '".$variant_id."' AND edate = 0"); safeCheck($check_product);				if ( $variant_id ){			$price_discount = getSpecialOfferPrice($product_id, $product["brand_id"], 0, $variant_id);		}else{			$price_discount = getSpecialOfferPrice($product_id, $product["brand_id"]);		}				$sql = "SELECT * FROM ".$variants_table." WHERE product_id = '".$product_id."' AND option_id = '".$variant_id."' AND edate = 0 AND quantity > 0";		$variant = $db->getRow($sql); safeCheck($variant);				if ( $variant["price"] ){			$price_use = $variant["price"];			$price_bonus_points_use = $variant["bonus_points"];			$product_weight = $variant["weight"];		}else{						if ($product["price_specialoffer"] > 0.0){				$price_use = $product["price_specialoffer"];			}else{				if ( $price_discount > 0.0 ){					$price_use = $price_discount;				}else{					$price_use = $product["price"];				}			}						$product_weight = $product["weight"];		}						$product_price_total = $price_use * $quantity;				$product_weight_total = $product_weight * $quantity;				$fields = array(							"product_id" => $product_id,							"cart_id" => $cart_id,							"variant_id" => $variant_id,							"product_image_id" => $product["product_image_id"],							"product_name" => $product["name"],							"product_code" => $product["code"],							"product_price" => $price_use,							"product_price_total" => $product_price_total,							"product_weight" => $product_weight,							"product_weight_total" => $product_weight_total,							"brand_name" => $product["brand_name"],							"quantity" => $quantity,							"postdate" => time(),							"ip_address" => $_SERVER["REMOTE_ADDR"],						);				$price_specialoffer = getSpecialOfferPrice($product["id"], $product["brand_id"], 1, $variant_id);		if ( $price_specialoffer["price_specialoffer"] > 0.0 ){			$fields["product_price_discount"] = $price_specialoffer["price_specialoffer"];		}				if ($check_product["quantity"] == 0){			$res = $db->autoExecute($carts_products_table, $fields, DB_AUTOQUERY_INSERT ); safeCheck($res);		}else{			$fields["quantity"] = $quantity+$check_product["quantity"];			$fields["product_weight_total"] = $fields["quantity"] * $check_product["product_weight"];			$res = $db->autoExecute($carts_products_table, $fields, DB_AUTOQUERY_UPDATE, " id = '".$check_product["id"]."'" ); safeCheck($res);		}	}	?>